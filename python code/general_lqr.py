import numpy as np
import control  # 若尚未安裝，請使用 pip install control

# ====================================================
# 參數設定（請依實際系統調整數值）
# ====================================================
# 機身物理性質
m_body = 0.98
I_body_roll = 13155550 / 1000000000
I_body_pitch = 11231450 / 1000000000

# 動量輪參數（兩輪相同）
J_wheel = 45900 / 1000000000

# 動量輪安裝位置
d = 115 / 1000
k12 = d
k21 = d

# ====================================================
# 狀態空間模型建立
# ====================================================
A = np.array([
    [0, 0, 1, 0],
    [0, 0, 0, 1],
    [0, 0, 0, 0],
    [0, 0, 0, 0]
])

B = np.array([
    [0, 0],
    [0, 0],
    [-J_wheel / I_body_roll, (k12 * J_wheel) / I_body_roll],
    [(k21 * J_wheel) / I_body_pitch, -J_wheel / I_body_pitch]
])

# ====================================================
# LQR 權重矩陣設定
# ====================================================
Q = np.diag([1000, 1000, 1, 1])
R = np.diag([0.8, 0.8])

# ====================================================
# LQR 控制器設計
# ====================================================
K, S, E = control.lqr(A, B, Q, R)

# ====================================================
# 轉換成 C 語言陣列格式
# ====================================================
K_c_format = "double K[2][4] = {\n"
for row in K:
    K_c_format += "    {" + ", ".join(f"{val:.6f}" for val in row) + "},\n"
K_c_format += "};"

print(K_c_format)
